<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Space Arc</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background: url("Arc.png") center/cover no-repeat;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      resetPlayerPosition();
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Images
    const playerImg = new Image();
    playerImg.src = "k.png";

    const meteorImg = new Image();
    meteorImg.src = "p.png";

    const bonusImg = new Image();
    bonusImg.src = "u.png";

    // Player (bigger size)
    const player = {
      x: 0,
      y: 0,
      w: 130,
      h: 130,
      speed: 7
    };

    function resetPlayerPosition() {
      player.x = canvas.width / 2 - player.w / 2;
      player.y = canvas.height - player.h - 40;
    }

    // Game state
    let meteors = [];
    let bonuses = [];
    let score = 0;
    let collected = 0;
    let started = false;
    let gameOver = false;
    let win = false;

    const TARGET_BONUSES = 20;

    // Simple frame counters for spawning
    let meteorTimer = 0;
    let bonusTimer = 0;
    const METEOR_INTERVAL_FRAMES = 55;
    const BONUS_INTERVAL_FRAMES = 160;
    const MAX_METEORS = 8;
    const MAX_BONUSES = 4;

    // Meteor speed-up (very gentle)
    let difficulty = 0;
    const DIFFICULTY_STEP = 0.0015; // grows slowly

    // Explosion flash when bonus collected
    let flashFrames = 0;

    // Keyboard
    const keys = new Set();
    window.addEventListener("keydown", (e) => {
      keys.add(e.code);
      if (!started && e.code === "Space") started = true;
      if ((gameOver || win) && e.code === "Space") resetGame();
    });
    window.addEventListener("keyup", (e) => keys.delete(e.code));

    // Mouse / touch start / restart
    canvas.addEventListener("click", () => {
      if (!started) started = true;
      else if (gameOver || win) resetGame();
    });

    function clampPlayer() {
      if (player.x < 0) player.x = 0;
      if (player.y < 0) player.y = 0;
      if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;
      if (player.y + player.h > canvas.height) player.y = canvas.height - player.h;
    }

    function spawnMeteor() {
      if (meteors.length >= MAX_METEORS) return;
      const size = Math.max(60, canvas.width * 0.07);
      const x = Math.random() * (canvas.width - size);
      const y = -size - 20;
      const baseSpeed = 4 + Math.random() * 2;
      const vy = baseSpeed + difficulty * 8; // speed grows with difficulty
      meteors.push({ x, y, w: size, h: size, vy });
    }

    function spawnBonus() {
      if (bonuses.length >= MAX_BONUSES) return;
      const size = Math.max(50, canvas.width * 0.06);
      const x = Math.random() * (canvas.width - size);
      const y = -size - 20;
      const vy = 3 + Math.random() * 2;
      bonuses.push({ x, y, w: size, h: size, vy });
    }

    function intersects(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    function update() {
      if (!started || gameOver || win) return;

      // Player movement
      const step = player.speed;
      if (keys.has("ArrowLeft") || keys.has("KeyA")) player.x -= step;
      if (keys.has("ArrowRight") || keys.has("KeyD")) player.x += step;
      if (keys.has("ArrowUp") || keys.has("KeyW")) player.y -= step;
      if (keys.has("ArrowDown") || keys.has("KeyS")) player.y += step;
      clampPlayer();

      // Difficulty slowly increases
      difficulty += DIFFICULTY_STEP;
      if (difficulty > 1) difficulty = 1;

      // Spawn meteors and bonuses
      meteorTimer++;
      bonusTimer++;

      if (meteorTimer >= METEOR_INTERVAL_FRAMES) {
        meteorTimer = 0;
        spawnMeteor();
      }

      if (bonusTimer >= BONUS_INTERVAL_FRAMES) {
        bonusTimer = 0;
        spawnBonus();
      }

      // Move meteors
      for (const m of meteors) {
        m.y += m.vy;
      }

      // Move bonuses
      for (const b of bonuses) {
        b.y += b.vy;
      }

      // Remove off-screen
      meteors = meteors.filter(m => m.y < canvas.height + 120);
      bonuses = bonuses.filter(b => b.y < canvas.height + 120);

      // Meteor collisions → Game Over
      for (const m of meteors) {
        if (intersects(player, m)) {
          gameOver = true;
          break;
        }
      }

      // Bonus collisions → add, clear meteors, flash
      for (let i = bonuses.length - 1; i >= 0; i--) {
        const b = bonuses[i];
        if (intersects(player, b)) {
          bonuses.splice(i, 1);
          collected++;
          score += 10;

          // Remove all meteors (boom)
          meteors = [];
          flashFrames = 10; // short light flash

          if (collected >= TARGET_BONUSES) {
            win = true;
          }
        }
      }

      if (flashFrames > 0) {
        flashFrames--;
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw meteors
      for (const m of meteors) {
        if (meteorImg.complete) {
          ctx.drawImage(meteorImg, m.x, m.y, m.w, m.h);
        } else {
          ctx.fillStyle = "rgba(255,80,80,0.8)";
          ctx.fillRect(m.x, m.y, m.w, m.h);
        }
      }

      // Draw bonuses
      for (const b of bonuses) {
        if (bonusImg.complete) {
          ctx.drawImage(bonusImg, b.x, b.y, b.w, b.h);
        } else {
          ctx.fillStyle = "gold";
          ctx.beginPath();
          ctx.arc(b.x + b.w / 2, b.y + b.h / 2, Math.min(b.w, b.h) / 2, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      // Draw player
      if (playerImg.complete) {
        ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
      } else {
        ctx.fillStyle = "#00ffff";
        ctx.fillRect(player.x, player.y, player.w, player.h);
      }

      // Explosion flash overlay
      if (flashFrames > 0) {
        const alpha = flashFrames / 10;
        ctx.fillStyle = "rgba(255, 230, 140," + alpha + ")";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      // HUD
      ctx.fillStyle = "rgba(0,0,0,0.55)";
      ctx.fillRect(10, 10, 280, 80);
      ctx.fillStyle = "#fff";
      ctx.font = "20px Arial";
      ctx.fillText("Space Arc", 20, 35);
      ctx.fillText("Score: " + score, 20, 60);
      ctx.fillText("Bonuses: " + collected + " / " + TARGET_BONUSES, 20, 85);

      // Start screen
      if (!started && !gameOver && !win) {
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.font = "44px Arial Black";
        ctx.textAlign = "center";
        ctx.fillText("Space Arc", canvas.width / 2, canvas.height / 2 - 40);
        ctx.font = "24px Arial";
        ctx.fillText("Press SPACE or CLICK to start", canvas.width / 2, canvas.height / 2 + 5);
        ctx.fillText("Move with arrows / WASD", canvas.width / 2, canvas.height / 2 + 40);
        ctx.textAlign = "left";
      }

      // Game Over
      if (gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.75)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.font = "46px Arial Black";
        ctx.textAlign = "center";
        ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 40);
        ctx.font = "26px Arial";
        ctx.fillText("Score: " + score + "   Bonuses: " + collected,
                     canvas.width / 2, canvas.height / 2 + 5);
        ctx.fillText("Press SPACE or CLICK to restart", canvas.width / 2, canvas.height / 2 + 45);
        ctx.textAlign = "left";
      }

      // Win screen — soft glow ✨
      if (win) {
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const r = Math.max(canvas.width, canvas.height) * 0.8;

        const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, r);
        gradient.addColorStop(0, "rgba(180, 255, 230, 0.95)");
        gradient.addColorStop(0.4, "rgba(120, 210, 255, 0.7)");
        gradient.addColorStop(1, "rgba(0, 0, 0, 0.9)");

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#ffffff";
        ctx.font = "52px Arial Black";
        ctx.textAlign = "center";
        ctx.fillText("YOU WIN!", canvas.width / 2, canvas.height / 2 - 20);
        ctx.font = "26px Arial";
        ctx.fillText("Bonuses collected: " + collected, canvas.width / 2, canvas.height / 2 + 20);
        ctx.fillText("Press SPACE or CLICK to play again", canvas.width / 2, canvas.height / 2 + 60);
        ctx.textAlign = "left";
      }
    }

    function resetGame() {
      resetPlayerPosition();
      meteors = [];
      bonuses = [];
      score = 0;
      collected = 0;
      difficulty = 0;
      meteorTimer = 0;
      bonusTimer = 0;
      flashFrames = 0;
      gameOver = false;
      win = false;
      started = true;
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // Initial position before loop
    resetPlayerPosition();
    loop();
  </script>
</body>
</html>
